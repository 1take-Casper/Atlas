<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard de Entrenamiento</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* Navbar transparente */
.navbar-glass {
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    background: rgba(255, 255, 255, 0.6);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}
@media (prefers-color-scheme: dark) {
    .navbar-glass { background: rgba(20, 20, 20, 0.6); border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
    .nav-link { color: white !important; }
}
.nav-icon { font-size: 1.25rem; }
.nav-link:hover { color: #0d6efd !important; }

/* Cards de rutina y estadísticas */
.card-rutina { margin-bottom: 20px; }
.stats-card { text-align: center; padding: 15px; color: white; }
.stats-card h3 { margin: 0; }
.bg-blue { background-color: #0d6efd; }
.bg-green { background-color: #198754; }
.bg-orange { background-color: #fd7e14; }
</style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-glass py-2">
    <div class="container d-flex justify-content-center position-relative">
        <ul class="nav gap-4">
            <li class="nav-item text-center"><a class="nav-link active" href="index.html"><i class="bi bi-house-door nav-icon"></i><br><small>Inicio</small></a></li>
            <li class="nav-item text-center"><a class="nav-link" href="rutina.html"><i class="bi bi-person-arms-up nav-icon"></i><br><small>Rutina</small></a></li>
            <li class="nav-item text-center"><a class="nav-link" href="progreso.html"><i class="bi bi-graph-up-arrow nav-icon"></i><br><small>Progreso</small></a></li>
            <li class="nav-item text-center"><a class="nav-link" href="resumen entrenamiento.html"><i class="bi bi-journal-text nav-icon"></i><br><small>Resumen</small></a></li>
        </ul>
        <button class="navbar-toggler position-absolute end-0" type="button" data-bs-toggle="offcanvas" data-bs-target="#menuLateral">
            <span class="navbar-toggler-icon"></span>
        </button>
    </div>
</nav>

<!-- Offcanvas Menu -->
<div class="offcanvas offcanvas-end" id="menuLateral">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title">Menú</h5>
        <button class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body">
        <ul class="list-group">
            <a href="index.html" class="list-group-item list-group-item-action"><i class="bi bi-house"></i> Inicio</a>
            <a href="rutina.html" class="list-group-item list-group-item-action"><i class="bi bi-dumbbell"></i> Rutina</a>
            <a href="progreso.html" class="list-group-item list-group-item-action"><i class="bi bi-graph-up-arrow"></i> Progreso</a>
            <a href="resumen entrenamiento.html" class="list-group-item list-group-item-action"><i class="bi bi-journal-text"></i> Resumen</a>
        </ul>
    </div>
</div>

<div class="container mt-5 pt-4">

    <!-- RUTINA DESTACADA -->
    <h3 class="mb-3">Rutina Destacada</h3>
    <div id="rutinaDestacada" class="row"></div>

    <!-- ESTADÍSTICAS RÁPIDAS -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="stats-card bg-blue">
                <h3 id="totalEntrenamientos">0</h3>
                <p>Total entrenamientos</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stats-card bg-green">
                <h3 id="totalEjercicios">0</h3>
                <p>Ejercicios completados</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stats-card bg-orange">
                <h3 id="mejorPeso">0 kg</h3>
                <p>Mejor peso</p>
            </div>
        </div>
    </div>

    <!-- TABLA DE PESOS -->
    <div class="card p-3 shadow-sm mb-4">
        <h4>Últimos pesos registrados</h4>
        <table class="table table-striped table-hover mt-3">
            <thead>
                <tr><th>Ejercicio</th><th>Peso (kg)</th></tr>
            </thead>
            <tbody id="tablaPesos"></tbody>
        </table>
    </div>

    <!-- GRÁFICOS POR EJERCICIO -->
    <div id="graficosEjercicios" class="row"></div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
<script>
const rutinaDiv = document.getElementById("rutinaDestacada");
const tablaPesos = document.getElementById("tablaPesos");
const graficosDiv = document.getElementById("graficosEjercicios");
const totalEntrenamientosEl = document.getElementById("totalEntrenamientos");
const totalEjerciciosEl = document.getElementById("totalEjercicios");
const mejorPesoEl = document.getElementById("mejorPeso");

// Obtener entrenamientos y rutinas de localStorage
let entrenamientos = JSON.parse(localStorage.getItem("entrenamientos")) || [];
let rutinas = JSON.parse(localStorage.getItem("misRutinas")) || [];

// Mostrar rutina destacada (última)
if(rutinas.length > 0){
    const ultimaRutina = rutinas[rutinas.length-1];
    ultimaRutina.ejercicios.forEach(ej => {
        const card = document.createElement("div");
        card.className = "col-md-3 card card-rutina p-3 shadow-sm m-2";
        card.innerHTML = `<h5>${ej}</h5>`;
        rutinaDiv.appendChild(card);
    });
} else {
    rutinaDiv.innerHTML = "<p>No hay rutinas guardadas.</p>";
}

// Estadísticas rápidas
totalEntrenamientosEl.textContent = entrenamientos.length;
let ejerciciosCompletados = [...new Set(entrenamientos.map(e=>e.ejercicio))];
totalEjerciciosEl.textContent = ejerciciosCompletados.length;
let pesos = entrenamientos.map(e=>e.peso);
mejorPesoEl.textContent = pesos.length>0 ? Math.max(...pesos) + " kg" : "0 kg";

// Tabla de últimos pesos
let ultimoPeso = {};
entrenamientos.forEach(e=>{
    ultimoPeso[e.ejercicio] = e.peso;
});
for(let ej in ultimoPeso){
    tablaPesos.innerHTML += `<tr><td>${ej}</td><td>${ultimoPeso[ej]} kg</td></tr>`;
}

// Gráficos por ejercicio
ejerciciosCompletados.forEach(ej=>{
    const cont = document.createElement("div");
    cont.className = "col-md-6 mb-4";
    cont.innerHTML = `<div class="card p-3 shadow-sm"><h5>${ej}</h5><canvas id="chart-${ej}"></canvas></div>`;
    graficosDiv.appendChild(cont);

    let datosEj = entrenamientos.filter(r=>r.ejercicio===ej);
    let fechas = datosEj.map(d=>d.fecha);
    let pesosEj = datosEj.map(d=>d.peso);

    new Chart(document.getElementById(`chart-${ej}`), {
        type: "line",
        data: {
            labels: fechas,
            datasets: [{ label: ej, data: pesosEj, borderColor:"rgb(54,162,235)", backgroundColor:"rgba(54,162,235,0.3)", tension:0.4, fill:true }]
        },
        options:{ responsive:true, scales:{ y:{ beginAtZero:true, title:{ display:true, text:"Peso (kg)" } } } }
    });
});
</script>
</body>
</html>
